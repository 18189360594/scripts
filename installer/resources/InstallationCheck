#!/usr/bin/perl
use File::Find;
use POSIX qw(uname);

my $result = 0, $basedir = "/sw";
my $PACKAGE_PATH = $ENV{PACKAGE_PATH};

DO_CHECKS:
{
	# The "19" specifies the index of the localized error string in
	# {English,Spanish,etc}.lproj/InstallationCheck.strings
	print "running InstallationCheck...\n";
	if ((-e "$basedir") || (-l "$basedir"))
	{
	  print "Fink Installer: ROOT /sw exists!\n";
	  $result = ((1 << 6) | (1 << 5) | 19);
  	  last;
	} 

	# x.y.z form
	my OSXVersion = qx{defaults read /System/Library/CoreServices/SystemVersion ProductUserVisibleVersion};
	chomp $OSXVersion;

	if ($OSXVersion != /^8\./)
	{
	print "Fink Installer: Fink requires Mac OS X 10.4 (Tiger) or later! Bailing out..\n";
       	$result = ((1 << 6) | (1 << 5) | 20);
        last;
	}

	# human-readable string, not a config.guess platform value
	# ("Power Macintosh" or "i386")
	my $CPUArch = (uname())[4];

	if ($CPUArch ne 'Power Macintosh')
	{
	print "Fink Installer: This Installer is for powerpc machines only! Bailing out..\n";
       	$result = ((1 << 6) | (1 << 5) | 21);
        last;
	}


}

exit $result;
