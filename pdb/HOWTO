Q: How do I update the package database?

A: You normally should never have to do this since we have a cron script in 
place that performs that job every 8 hours for us. But if for some reasons it
is necessary to perform such an update right on the spot, proceed as follows.

First log into the opendarwin.org server:
  ssh MYODUSERNAME@sampson.opendarwin.org

The first time you are doing this, you have to create two auxiliary files:
~/bin/finksql:
#!/bin/sh
exec mysql -h localhost -u fink --password=DBPASSWORD fink

~/.finkdbi:
DBI:mysql:database=fink;host=localhost|fink|DBPASSWORD

You probably should chmod go-rw the two files, and also chmod u+x the finksql
script. If you don't know the value for "DBPASSWORD", ask the project admin.

Now change into the PDB directory:
  cd /Volumes/src2/fink/pdb.finkproject.org/pdb/

Refresh the list of packages (essentially this runs a 'cvs up'):
  ./refresh

Finally, insert the package descriptions:
  ./inject

That should be it!

---------------------------------------------------------------------------------

Q: How do I update the PDB for a full fink release?

A: Assuming you just released fink 0.4.5, you'll want to adjust the package
database accordingly. 

First log into the opendarwin.org server:
  ssh MYODUSERNAME@sampson.opendarwin.org

We assume that you setup the necessary auxiliary files already, if not read
the above Q&A for information on how to do it.
Now change into the PDB directory:
  cd /Volumes/src2/fink/pdb.finkproject.org/pdb/

Next dump the list of packages in the release. Replace 0.8.1 as appropriate, 
replace '10.4' with the Fink tree you want to count as stable, and replace
'i386' with the architecture you wish to use (i386 or powerpc):

 ./dumprelease 0.8.1 10.4 i386
 
This will produce a file called 0.8.1-i386-stable.sql. Next, you must update the
releases.sql file for 0.8.1 (just replace the current version with the new
one). You best do that in CVS using a developer checkout on your local machine,
then check the change in, and run "cvs up" on the shell server.
Once you did this, run these commands (order is important):
  ~/bin/finksql < releases.sql
  ~/bin/finksql < 0.8.1-i386-stable.sql

(If you have released 0.8.1 for multiple architectures, you can add a 
command to this list such as ~/bin/finksql < 0.8.1-powerpc-stable.sql .)

Now run the "flag" script:
  ./flag

Finally, you have to tell the PHP script which renders the package description
pages to display the information from 0.8.1 along with the current data. To do
so, edit "pdb/releases.inc" in the "web" CVS module.

(NOTE: prior to 0.8.1, the architecture was not included in the .sql file
name or the release string.  The current pdb/releases.inc file accounts
for this correctly, but if the .sql files for earlier releases are ever
rebuilt, either it will have to be modified or an earlier version of the
dumprelease script should be used.)

That's it.

---------------------------------------------------------------------------------

This HOWTO was written by Max Horn, largely based on some instructions given
by Christoph Pfisterer. Use at your own risk.
